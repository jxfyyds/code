<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {

            background: url("/img/1.jpeg") no-repeat;

            background-size: cover;
        }
    </style>
</head>

<body>
    <div class="caixa" style="text-align: center;">


        <h1 style="text-align: center;">登陆页面</h1>
        <!-- javascript:;阻止默认行为 -->
        <!-- <form action="" method="post" style="text-align: center;"> -->

        <p>
            用户名：
            <input type="text" name="username" id="username" placeholder='请输入你的用户名'>
        </p>
        <p>
            密码：
            <input type="password" name="password" id="password" placeholder='请输入你的密码'>
        </p>
        <p>
            <button id="Login">登录</button></button>
        </p>
        <p>
            <a href="/registo">注册</a>
        </p>
        <div id="message">

        </div>
        <!-- </form> -->
    </div>
</body>
<script>

    let usernameEle = document.getElementById('username')
    let passwordEle = document.getElementById('password')
    let LoginEle = document.getElementById('Login')
    let messageEle = document.getElementById('message')

    LoginEle.onclick = function () {
        let username = usernameEle.value;
        let password = passwordEle.value;

        //3. 基本信息基本校验
        //1. 用户名最少6位，不能包含特殊字符
        let usernameReg = /^[a-zA-Z0-9\u4e00-\u9fa5]{6,}$/;
        if (!usernameReg.test(username)) {
            messageEle.innerHTML = '<span class="error">用户名最少6位，不能包含特殊字符</span>'
            return false;
        }

        //2. 密码不能少于8位
        let passwordReg = /^.{6,}$/;
        if (!passwordReg.test(password)) {
            messageEle.innerHTML = '<span class="error">密码不能少于8位</span>'
            return false;
        }

        messageEle.innerHTML = '';
        LoginEle.setAttribute('disabled', 'disabled')
        LoginEle.innerHTML = '登陆中...'

        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (this.readyState === 4 && this.status === 200) {
                let data = JSON.parse(this.responseText)
                LoginEle.removeAttribute('disabled')
                LoginEle.innerText = '登录'
                let { errcode, message } = data
                if (errcode == '200') {
                    alert('登陆成功')
                    location.href = '/';
                } else {
                    alert('用户名或密码错误')
                }
            }
        }
        let formdata=`username=${username}&password=${password}`
        xhr.open('post', 'ajaxlogin', true)
        xhr.setRequestHeader("Content-type", 'application/x-www-form-urlencoded')
        username = encodeURIComponent(username);
        password = encodeURIComponent(password);
        xhr.send(formdata)

    }


    // document.getElementById('Login').onclick = function () {
    //     let username = document.getElementById('username').value
    //     let password = document.getElementById('password').value
    //     // 创建 Ajax对象
    //     let xhr = new XMLHttpRequest();
    //     //监听
    //     xhr.onreadystatechange = function () {
    //         //readyState : 获取ajax对象请求的状态。
    //         //status请求状态码；
    //         if (this.readyState === 4 && this.status === 200) {
    //             // 接收服务器传过来的数据,格式是字符串形式，需转为json格式:JSON.parse()
    //             let data = JSON.parse(xhr.responseText);
    //             let { errcode, message } = data
    //             if (errcode === 200) {
    //                 alert(message)
    //                 location.href ='/'
    //             } else {
    //                 alert(message)
    //             }

    //         }
    //     }
    //     // 拼接参数
    //     let logins = `username=${username}&password=${password}`
    //     //设置请求方式、请求接口，true是异步 false是同步
    //     xhr.open('post', '/dologin', true)
    //     // 设置post参数请求头
    //     xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
    //     //   发送请求 
    //     xhr.send(logins)
    // }

    // function submit() {
    //     let username = document.getElementById('username').value
    //     let password = document.getElementById('password').value
    //     let usernameRegular = /^[a-z A-Z0-9]{6,}$/;

    //     if (!usernameRegular.test(username)) {
    //         alert('用户名最少六位，不能包含特殊字符')
    //         return false;
    //     }

    //     let passwordReg = /^.{6,}$/
    //     if (!password.test(password)) {
    //         alert('密码不能少于6位')
    //         return false;
    //     }

    //     return true;

    // }
</script>

</html>